!function e(t,n,i){function o(a,l){if(!n[a]){if(!t[a]){var r="function"==typeof require&&require;if(!l&&r)return r(a,!0);if(s)return s(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var d=n[a]={exports:{}};t[a][0].call(d.exports,function(e){var n=t[a][1][e];return o(n?n:e)},d,d.exports,e,t,n,i)}return n[a].exports}for(var s="function"==typeof require&&require,a=0;a<i.length;a++)o(i[a]);return o}({1:[function(e,t,n){var i,o=Backbone.$;i=Marionette.Application.extend({el:document.querySelector("#tailor"),initialize:function(){this._collapsed=!1,this._unsavedChanges=!1,this.saveButton=document.querySelector("#tailor-save"),this.allowableEvents=["element:add","element:move","element:resize","element:change:order","element:copy","element:delete","elements:restore","elements:reset","modal:open","modal:destroy","template:add"],this.addEventListeners()},hasUnsavedChanges:function(){return this._unsavedChanges},addEventListeners:function(){var e=this;e.onSettingChange=function(){e.saveButton.disabled=!1,e.saveButton.innerHTML=window._l10n.publish,e._unsavedChanges=!0},e.listenTo(e.channel,"sidebar:setting:change",e.onSettingChange),e.listenTo(e.channel,_.without(e.allowableEvents,"modal:open","modal:destroy").join(" "),e.onSettingChange),e.listenTo(e.channel,["modal:apply"].join(" "),e.onSettingChange),e.onCollapse=function(){e._collapsed=!e._collapsed,e.el.classList.toggle("is-collapsed",e._collapsed),e.saveButton.setAttribute("aria-expanded",!e._collapsed),e.triggerMethod("collapse:sidebar")};var t=document.querySelector("#tailor-collapse");t.addEventListener("click",e.onCollapse),e.onSave=function(){e.el.classList.add("is-saving"),e.saveButton.setAttribute("disabled",!0);var t=e.channel.request("canvas:elements"),n=e.channel.request("sidebar:settings"),i={data:{post_id:window.post.id,models:JSON.stringify(t.toJSON()),settings:JSON.stringify(n.toJSON()),nonce:window._nonces.save},success:function(){e.saveButton.disabled=!0,e.saveButton.innerHTML=window._l10n.saved,e._unsavedChanges=!1,e.channel.trigger("sidebar:save")},error:function(t){e.saveButton.disabled=!1,t&&t.hasOwnProperty("message")?Tailor.Notify(t.message):"0"==t?Tailor.Notify(window._l10n.expired):"-1"==t?Tailor.Notify(window._l10n.invalid):Tailor.Notify(window._l10n.error)},complete:function(t){e.el.classList.remove("is-saving")}};window.ajax.send("tailor_save",i)},e.saveButton.addEventListener("click",e.onSave),e.listenToOnce(e.channel,"canvas:initialize",e.registerRemoteChannel),o(document).on("keydown",function(t){t.ctrlKey&&89==t.keyCode&&(_.contains(["INPUT","SELECT","TEXTAREA"],t.target.tagName)||e.channel.trigger("history:redo"))}),o(document).on("keydown",function(t){t.ctrlKey&&90==t.keyCode&&(_.contains(["INPUT","SELECT","TEXTAREA"],t.target.tagName)||e.channel.trigger("history:undo"))})},registerRemoteChannel:function(){var e=this,t=this.el.querySelector("#tailor-sidebar-preview");if(window.location.origin===t.contentWindow.location.origin){var n=t.contentWindow.app.channel,i=function(e){return n.request("canvas:elements",e)},o=function(e){return n.request("sidebar:history",e)},s=function(){return n.request("canvas:element:selected")};app.channel.reply("canvas:elements",i),app.channel.reply("sidebar:history",o),app.channel.reply("canvas:element:selected",s),e.listenTo(n,"all",e.forwardRemoteEvent),e.el.classList.add("is-initialized"),e.el.querySelector(".tailor-preview__viewport").classList.add("is-loaded"),n.trigger("sidebar:initialize")}},forwardRemoteEvent:function(e){var t=_.contains(this.allowableEvents,e);t&&this.channel.trigger.apply(this.channel,arguments)},maybeCollapse:function(e){13===e.keyCode&&this.onCollapse()},maybeSave:function(e){13===e.keyCode&&this.onSave()}}),t.exports=i},{}],2:[function(e,t,n){var i={},o=function(e){var t=e.get("id");i[t]&&_.each(i[t],function(t){t.apply(app,[e.get("value"),e.previous("value")])})};app.listenTo(app.channel,"sidebar:setting:change",o),t.exports=function(e,t){"function"==typeof t&&(i[e]=i[e]||[],i[e].push(t))}},{}],3:[function(e,t,n){t.exports=Marionette.Behavior.extend({events:{dragstart:"onDragStart",dragend:"onDragEnd",drag:"onDrag"},onDragStart:function(e){app.channel.trigger("canvas:dragstart",e.originalEvent,this.view)},onDrag:function(e){app.channel.trigger("canvas:drag",e.originalEvent,this.view)},onDragEnd:function(e){app.channel.trigger("canvas:dragend",e.originalEvent,this.view)}})},{}],4:[function(e,t,n){t.exports=Marionette.Behavior.extend({ui:{backButton:".back-button",helpButton:".help-button",helpDescription:".help-description",searchBar:".search"},events:{"click @ui.helpButton":"toggleHelp","change @ui.searchBar":"doSearch","input @ui.searchBar":"doSearch","keyup @ui.searchBar":"doSearch","search @ui.searchBar":"doSearch"},triggers:{"click @ui.backButton":"back"},toggleHelp:function(){this.ui.helpButton.toggleClass("is-open"),this.ui.helpDescription.slideToggle(150)},doSearch:function(e){this.view.collection.doSearch(e.target.value)}})},{}],5:[function(e,t,n){t.exports=Marionette.Behavior.extend({ui:{handle:".modal__title"},events:{mousemove:"onMouseMove",mousedown:"onMouseDown","dblclick @ui.handle":"toggleFullScreen"},initialize:function(){this._isResizing=!1,this._isResizing=!1,this.$ghostPane=jQuery('<div class="ghost-pane"></div>').appendTo("body"),this.addEventListeners()},addEventListeners:function(){var e=this;window.addEventListener("resize",function(){e.checkPosition()},!1)},detectEdges:function(e){var t=this.el.getBoundingClientRect(),n=e.clientX-t.left,i=e.clientY-t.top,o=8,s=[];return o>i&&s.push("top"),i>=t.height-o&&s.push("bottom"),o>n&&s.push("left"),n>=t.width-o&&s.push("right"),s},onMouseMove:function(e){if(!this._isResizing&&!this._isDragging){this.$el.removeClass("top top-left top-right left right bottom bottom-left bottom-right is-draggable");var t=this.detectEdges(e);!t.length||this.container.classList.contains("is-full-screen")||document.body.classList.contains("mce-fullscreen")?e.target.classList.contains("modal__title")&&this.el.classList.add("is-draggable"):this.$el.addClass(t.join("-"))}},onMouseDown:function(e){if(!this._isResizing&&!this._isDragging){var t=this.detectEdges(e);!t.length||this.$container.hasClass("is-full-screen")||document.body.classList.contains("mce-fullscreen")?e.target===this.ui.handle.get(0)&&this.drag(e):this.resize(e,t)}},resize:function(e,t){function n(e){var t=a*(e.pageX-l),n=a*(e.pageY-r);switch(s){case"top":d+=n,d>400&&(o.container.style.height=d+"px",o.container.style.top=parseInt(o.container.style.top,10)-n+"px");break;case"bottom":d+=n,d>400&&(o.container.style.height=d+"px");break;case"left":c+=t,c>300&&(o.container.style.width=c+"px",o.container.style.left=parseInt(o.container.style.left,10)-t+"px");break;case"right":c+=t,c>300&&(o.container.style.width=c+"px");break;case"top-left":d+=n,c+=t,c>300&&(o.container.style.width=c+"px",o.container.style.left=parseInt(o.container.style.left,10)-t+"px"),d>400&&(o.container.style.height=d+"px",o.container.style.top=parseInt(o.container.style.top,10)-n+"px");break;case"top-right":d+=n,c-=t,c>300&&(o.container.style.width=c+"px"),d>400&&(o.container.style.height=d+"px",o.container.style.top=parseInt(o.container.style.top,10)-n+"px");break;case"bottom-left":d-=n,c+=t,c>300&&(o.container.style.width=c+"px",o.container.style.left=parseInt(o.container.style.left,10)-t+"px"),d>400&&(o.container.style.height=d+"px");break;case"bottom-right":d+=n,c+=t,c>300&&(o.container.style.width=c+"px"),d>400&&(o.container.style.height=d+"px")}o.triggerResize(c,d),r=e.pageY,l=e.pageX}function i(e){o._isResizing=!1,document.body.classList.remove("is-dragging"),document.removeEventListener("mousemove",n,!1),document.removeEventListener("mouseup",i,!1),o.checkPosition(150)}var o=this,s=t.join("-"),a=_.contains(t,"top")||_.contains(t,"left")?-1:1;this._isResizing=!0,document.body.classList.add("is-dragging"),document.addEventListener("mousemove",n,!1),document.addEventListener("mouseup",i,!1);var l=e.pageX,r=e.pageY,c=parseInt(o.container.style.width,10),d=parseInt(o.container.style.height,10)},drag:function(e){function t(e){document.body.classList.add("is-dragging"),s.container.style.top=parseInt(s.container.style.top,10)+(e.pageY-o)+"px",s.container.style.left=parseInt(s.container.style.left,10)+(e.pageX-i)+"px",e.pageX<5?s.$ghostPane.css({display:"block"}).addClass("left"):e.pageX>window.innerWidth-5?s.$ghostPane.css({display:"block"}).addClass("right"):e.pageY<5?s.$ghostPane.css({display:"block"}).addClass("top"):(s.resetGhostPane(),s.container.classList.contains("is-full-screen")&&(s.$container.removeClass("is-full-screen is-full-screen-left is-full-screen-right"),s.container.style.top=e.pageY-20+"px",s.container.style.left=e.pageX-parseInt(s.container.style.width,10)/2+"px",s.triggerResize(parseInt(s.container.style.width,10),parseInt(s.container.style.height,10)))),i=e.pageX,o=e.pageY}function n(e){s._isDragging=!1,document.body.classList.remove("is-dragging"),document.removeEventListener("mousemove",t,!1),document.removeEventListener("mouseup",n,!1),s.maybeToggleFullScreen(e)}var i,o,s=this;this._isDragging=!0,document.addEventListener("mousemove",t,!1),document.addEventListener("mouseup",n,!1)},maybeToggleFullScreen:function(e){var t;e.pageY<5?t="top":e.pageX<5?t="left":e.pageX>window.innerWidth-5&&(t="right"),t?this.enterFullScreen(t):this.checkPosition(150)},toggleFullScreen:function(){this.container.classList.contains("is-full-screen")?this.exitFullScreen():this.enterFullScreen("top")},enterFullScreen:function(e){this.$container.removeClass("is-full-screen is-full-screen-left is-full-screen-right"),this.container.classList.add("is-full-screen"),this.container.classList.add("is-full-screen-"+e);var t=this.container.getBoundingClientRect();this.triggerResize(t.width,t.height)},exitFullScreen:function(){this.$container.removeClass("is-full-screen is-full-screen-left is-full-screen-right"),this.triggerResize(parseInt(this.container.style.width,10),parseInt(this.container.style.height,10)),this.checkPosition(150),this.resetGhostPane()},triggerResize:function(e,t){this.view.trigger("modal:resize",e,t)},resetGhostPane:function(){this.$ghostPane.css({display:"none"}),this.$ghostPane[0].className="ghost-pane"},onShow:function(){this.container=this.el.parentNode,this.$container=this.$el.parent(),this.checkPosition()},checkPosition:function(e){e=e||0;var t=parseInt(this.container.style.width,10),n=parseInt(this.container.style.height,10),i=parseInt(this.container.style.top,10),o=parseInt(this.container.style.left,10),s={};i<window.scrollY?s.top=window.scrollY:i+n>window.scrollY+window.innerHeight&&(s.top=Math.max(window.scrollY+window.innerHeight-n,window.scrollY)),0>o?s.left=window.scrollX:o+t>window.scrollX+window.innerWidth&&(s.left=Math.max(window.scrollX+window.innerWidth-t,window.scrollX)),e?this.$container.animate(s,e):this.$container.css(s)},onDestroy:function(){this.$ghostPane.remove()}})},{}],6:[function(e,t,n){t.exports=Marionette.ItemView.extend({tagName:"li",className:function(){return"control control--"+this.model.get("type")},events:{"input @ui.input":"onControlChange","change @ui.input":"onControlChange","click @ui.default":"restoreDefaultValue"},getTemplate:function(){return"#tmpl-tailor-control-"+this.model.get("type")},serializeData:function(){var e=Backbone.Marionette.ItemView.prototype.serializeData.apply(this,arguments),t=this.getDefaultValue();return e.value=this.getSettingValue(),e.showDefault=null!=t&&e.value!=t,e},initialize:function(){this.addEventListeners(),this.checkDependencies(this.model.setting)},addEventListeners:function(){this.listenTo(this.model.setting,"change",this.toggleDefaultButton),this.listenTo(this.model.setting.collection,"change",this.checkDependencies)},checkDependencies:function(e){var t=this.model.get("dependencies"),n=e.collection,i=!0;for(var o in t)if(t.hasOwnProperty(o)){var s=n.get(o);if(!s)continue;var a=t[o].condition,l=s.get("value"),r=t[o].value;if(!this.checkCondition(a,l,r)){i=!1;break}}this.$el.toggle(i)},checkCondition:function(e,t,n){switch(e){case"equals":return t===n;case"not":return _.isArray(n)?-1===n.indexOf(t):t!==n;case"lessThan":return t<parseInt(n,10);case"greaterThan":return t>parseInt(n,10);case"contains":if(_.isString(t)&&(t=t.split(",")),_.isArray(n)){var i=_.intersection(n,t);return 0!==i.length}return-1!==_.indexOf(t,n)}},onControlChange:function(e){this.setSettingValue(this.ui.input.val())},toggleDefaultButton:function(){var e=this.getDefaultValue();this.ui["default"].toggleClass("is-hidden",null==e||this.getSettingValue()==e)},getSettingValue:function(){return this.model.setting.get("value")},setSettingValue:function(e){this.model.setting.set("value",e)},getDefaultValue:function(){return this.model.setting.get("default")},restoreDefaultValue:function(e){this.setSettingValue(this.getDefaultValue()),this.triggerMethod("restore:default")}})},{}],7:[function(e,t,n){var i,o=(Backbone.$,e("./abstract-control"));i=o.extend({ui:{input:"button","default":".js-default"},events:{"click @ui.input":"onControlChange","click @ui.default":"restoreDefaultValue"},templateHelpers:{active:function(e){return e===this.value?"active":""}},addEventListeners:function(){this.listenTo(this.model.setting,"change",this.render),this.listenTo(this.model.setting.collection,"change",this.checkDependencies)},onControlChange:function(e){var t=e.currentTarget;this.ui.input.removeClass("active"),t.classList.add("active"),this.setSettingValue(t.value)}}),t.exports=i},{"./abstract-control":6}],8:[function(e,t,n){var i,o=(Backbone.$,e("./abstract-control"));i=o.extend({ui:{input:"input","default":".js-default"},templateHelpers:{checked:function(e){var t=this.value.split(",");return-1!==t.indexOf(e)?"checked":""}},addEventListeners:function(){this.listenTo(this.model.setting,"change",this.render),this.listenTo(this.model.setting.collection,"change",this.checkDependencies)},onControlChange:function(e){var t=[];_.each(this.ui.input,function(e){e.checked&&t.push(e.value)}),this.setSettingValue(t.join(","))}}),t.exports=i},{"./abstract-control":6}],9:[function(e,t,n){var i,o=(Backbone.$,e("./abstract-control"));i=o.extend({ui:{input:"textarea","default":".js-default"},events:{"click @ui.default":"restoreDefaultValue"},serializeData:function(){var e=Backbone.Marionette.ItemView.prototype.serializeData.apply(this,arguments),t=this.getDefaultValue();return e.value=this.getSettingValue(),e.showDefault=null!=t&&e.value!=t,e.cid=this.cid,e},onRender:function(){var e=this,t=this.model.get("mode");e.editor=CodeMirror.fromTextArea(this.ui.input.get(0),{mode:t,lineNumbers:!0,matchBrackets:!0,continueComments:"Enter",viewportMargin:1/0,extraKeys:{F11:function(e){e.setOption("fullScreen",!e.getOption("fullScreen"))},Esc:function(e){e.getOption("fullScreen")&&e.setOption("fullScreen",!1)}}});var n=function(t){e.setSettingValue(t.getValue())};this.editor.on("change",n)},restoreDefaultValue:function(e){var t=this.getDefaultValue();this.setSettingValue(t),this.editor.setValue(t)},onDestroy:function(){this.editor.off("change",this.onChange),this.editor.toTextArea()}}),t.exports=i},{"./abstract-control":6}],10:[function(e,t,n){var i,o=(Backbone.$,e("./abstract-control"));!function(e){var t="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAIAAAHnlligAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAHJJREFUeNpi+P///4EDBxiAGMgCCCAGFB5AADGCRBgYDh48CCRZIJS9vT2QBAggFBkmBiSAogxFBiCAoHogAKIKAlBUYTELAiAmEtABEECk20G6BOmuIl0CIMBQ/IEMkO0myiSSraaaBhZcbkUOs0HuBwDplz5uFJ3Z4gAAAABJRU5ErkJggg==",n='<a tabindex="0" class="wp-color-result" />',i='<div class="wp-picker-holder" />',o='<div class="wp-picker-container" />',s='<input type="button" class="button button-small hidden" />';Color.fn.toString=function(){if(this._alpha<1)return this.toCSS("rgba",this._alpha).replace(/\s+/g,"");var e=parseInt(this._color,10).toString(16);if(this.error)return"";if(e.length<6)for(var t=6-e.length-1;t>=0;t--)e="0"+e;return"#"+e},e.widget("wp.wpColorPicker",e.wp.wpColorPicker,{_create:function(){if(e.support.iris){var a=this,l=a.element;e.extend(a.options,l.data()),a.close=e.proxy(a.close,a),a.initialValue=l.val(),l.addClass("wp-color-picker").hide().wrap(o),a.wrap=l.parent(),a.toggler=e(n).insertBefore(l).css({backgroundColor:a.initialValue}).attr("title",wpColorPickerL10n.pick).attr("data-current",wpColorPickerL10n.current),a.pickerContainer=e(i).insertAfter(l),a.button=e(s),a.options.defaultColor?a.button.addClass("wp-picker-default").val(wpColorPickerL10n.defaultString):a.button.addClass("wp-picker-clear").val(wpColorPickerL10n.clear),l.wrap('<span class="wp-picker-input-wrap" />').after(a.button),l.iris({target:a.pickerContainer,hide:a.options.hide,width:a.options.width,mode:a.options.mode,palettes:a.options.palettes,change:function(n,i){a.options.rgba?(a.toggler.css({"background-image":"url("+t+")"}).html("<span />"),a.toggler.find("span").css({width:"100%",height:"100%",position:"absolute",top:0,left:0,"border-top-left-radius":"3px","border-bottom-left-radius":"3px",background:i.color.toString()})):a.toggler.css({backgroundColor:i.color.toString()}),e.isFunction(a.options.change)&&a.options.change.call(this,n,i)}}),l.val(a.initialValue),a._addListeners(),a.options.hide||a.toggler.click()}},_addListeners:function(){var t=this;t.wrap.on("click.wpcolorpicker",function(e){e.stopPropagation()}),t.toggler.click(function(){t.toggler.hasClass("wp-picker-open")?t.close():t.open()}),t.element.change(function(n){var i=e(this),o=i.val();(""===o||t.element.hasClass("iris-error"))&&(t.options.rgba?(t.toggler.removeAttr("style"),t.toggler.find("span").css("backgroundColor","")):t.toggler.css("backgroundColor",""),e.isFunction(t.options.clear)&&t.options.clear.call(this,n))}),t.toggler.on("keyup",function(e){(13===e.keyCode||32===e.keyCode)&&(e.preventDefault(),t.toggler.trigger("click").next().focus())}),t.button.click(function(n){var i=e(this);i.hasClass("wp-picker-clear")?(t.element.val(""),t.options.rgba?(t.toggler.removeAttr("style"),t.toggler.find("span").css("backgroundColor","")):t.toggler.css("backgroundColor",""),e.isFunction(t.options.clear)&&t.options.clear.call(this,n)):i.hasClass("wp-picker-default")&&t.element.val(t.options.defaultColor).change()})}}),e.widget("a8c.iris",e.a8c.iris,{_create:function(){if(this._super(),this.options.rgba=this.element.data("rgba")||!1,this.element.is(":input")||(this.options.alpha=!1),"undefined"!=typeof this.options.rgba&&this.options.rgba){var t=this,n=(t.element,'<div class="iris-strip iris-slider iris-alpha-slider"><div class="iris-slider-offset iris-slider-offset-alpha"></div></div>'),i=e(n).appendTo(t.picker.find(".iris-picker-inner")),o=i.find(".iris-slider-offset-alpha"),s={aContainer:i,aSlider:o};e.each(s,function(e,n){t.controls[e]=n}),t.controls.square.css({"margin-right":"0"});var a=t.picker.width()-t.controls.square.width()-20,l=a/6,r=a/2-l;e.each(["aContainer","strip"],function(e,n){t.controls[n].width(r).css({"margin-left":l+"px"})}),t._initControls(),t._change()}},_initControls:function(){if(this._super(),this.options.rgba){var e=this,t=e.controls;t.aSlider.slider({orientation:"vertical",min:0,max:100,step:1,value:parseInt(100*e._color._alpha),slide:function(t,n){e._color._alpha=parseFloat(n.value/100),e._change.apply(e,arguments)}})}},_change:function(){this._super();var e=this,n=e.element;if(this.options.rgba){var i=e.controls,o=parseInt(100*e._color._alpha),s=e._color.toRgb(),a=["rgb("+s.r+","+s.g+","+s.b+") 0%","rgba("+s.r+","+s.g+","+s.b+", 0) 100%"],l=e.options.defaultWidth,r=e.options.customWidth,c=e.picker.closest(".wp-picker-container").find(".wp-color-result");if(i.aContainer.css({background:"linear-gradient(to bottom, "+a.join(", ")+"), url("+t+")"}),c.hasClass("wp-picker-open"))if(i.aSlider.slider("value",o),e._color._alpha<1){var d=i.strip.attr("style").replace(/rgba\(([0-9]+,)(\s+)?([0-9]+,)(\s+)?([0-9]+)(,(\s+)?[0-9\.]+)\)/g,"rgb($1$3$5)");i.strip.attr("style",d),n.width(parseInt(l+r))}else n.width(l)}var u=n.data("reset-alpha")||!1;u&&e.picker.find(".iris-palette-container").on("click.palette",".iris-palette",function(){e._color._alpha=1,e.active="external",e._change()})},_addInputListeners:function(e){var t=this,n=100,i=function(n){var i=new Color(e.val()),o=e.val();e.removeClass("iris-error"),i.error?""!==o&&e.addClass("iris-error"):i.toString()!==t._color.toString()&&("keyup"===n.type&&o.match(/^[0-9a-fA-F]{3}$/)||t._setOption("color",i.toString()))};e.on("change",i).on("keyup",t._debounce(i,n)),t.options.hide&&e.one("focus",function(){t.show()})}})}(jQuery),i=o.extend({ui:{input:"input"},events:{},serializeData:function(){var e=Backbone.Marionette.ItemView.prototype.serializeData.apply(this,arguments);return e.value=this.model.setting.get("value"),e.rgba=this.model.get("rgba"),e},addEventListeners:function(){this.listenTo(this.model.setting.collection,"change",this.checkDependencies)},onRender:function(){var e=this;this.ui.input.wpColorPicker({palettes:this.model.get("palettes"),defaultColor:e.getDefaultValue(),change:function(){e.setSettingValue(e.ui.input.wpColorPicker("color"))},clear:function(){e.setSettingValue("")}})},onBeforeDestroy:function(){this.ui.input.wpColorPicker("close")}}),t.exports=i},{"./abstract-control":6}],11:[function(e,t,n){var i,o=(Backbone.$,e("./abstract-control"));i=o.extend({ui:{input:"textarea","default":".js-default"},getTemplate:function(){var e=document.getElementById("tmpl-tailor-control-editor").innerHTML;return _.template(e.replace(new RegExp("tailor-editor","gi"),this.cid).replace(new RegExp("tailor-value","gi"),"<%= value %>"))},addEventListeners:function(){this.listenTo(this.model.setting,"change",this.toggleDefaultButton),this.listenTo(this.model.setting.collection,"change",this.checkDependencies),this.listenTo(app.channel,"list:change:order",this.maybeRefreshEditor)},maybeRefreshEditor:function(e){e.contains(this.el)&&(tinyMCE.execCommand("mceRemoveEditor",!1,this.cid),tinyMCE.execCommand("mceAddEditor",!1,this.cid))},onAttach:function(){var e=this.ui.input,t=this.cid,n=_.extend({},tinyMCEPreInit.qtInit["tailor-editor"],{id:t});quicktags(n),QTags._buttonsInit(),tinyMCEPreInit.mceInit[t]=_.extend({},tinyMCEPreInit.mceInit["tailor-editor"],{id:t,resize:"vertical",height:350,setup:function(t){t.on("change",function(){t.save(),e.change()})}}),switchEditors.go(t,"tmce"),tinymce.execCommand("mceAddEditor",!0,t)},restoreDefaultValue:function(e){var t=this.getDefaultValue();this.setSettingValue(t),tinyMCE.get(this.cid).setContent(t)},onDestroy:function(){tinyMCE.execCommand("mceRemoveEditor",!0,this.cid)}}),t.exports=i},{"./abstract-control":6}],12:[function(e,t,n){var i,o=(Backbone.$,e("./abstract-control"));i=o.extend({ui:{select:".button--select",change:".button--change",remove:".button--remove",thumbnails:".thumbnails","default":".js-default"},events:{"click @ui.select":"selectImages","click @ui.change":"selectImages","click @ui.thumbnails":"selectImages","click @ui.remove":"removeImages","click @ui.default":"restoreDefaultValue"},serializeData:function(){var e=Backbone.Marionette.ItemView.prototype.serializeData.apply(this,arguments),t=this.getDefaultValue();return e.value=this.getSettingValue(),e.showDefault=null!=t&&e.value!=t,e.ids=this.ids(),e},addEventListeners:function(){this.listenTo(this.model.setting,"change",this.render),this.listenTo(this.model.setting.collection,"change",this.checkDependencies)},selectImages:function(){var e,t=this,n=this.ids(),i=this.getSelection(n),o=wp.media({frame:"post",state:n.length?"gallery-edit":"gallery-library",editing:!0,multiple:!0,selection:i});o.on("open",function(){var t=o.views.get(".media-frame-menu")[0];t.$el.children().slice(0,2).hide(),e=JSON.stringify(i.toJSON())}).on("update",function(n){var i=n.pluck("id").join(",");t.setSettingValue(i),_.isEqual(e,JSON.stringify(n.toJSON()))||t.model.setting.trigger("change",t.model.setting,i),t.updateThumbnails(n)}).on("close",function(){o.dispose()}),o.open()},removeImages:function(){this.setSettingValue(""),this.render()},onRender:function(){this.generateThumbnails()},generateThumbnails:function(){var e=this,t=this.ids();if(t.length){var n=this.getSelection(this.ids());n.more().done(function(){n.props.set({query:!1}),n.unmirror(),n.props.unset("orderby"),e.updateThumbnails(n)})}},updateThumbnails:function(e){var t="",n=e.map(function(e){var t,n=e.get("sizes");return t=n.hasOwnProperty("medium")?n.medium.url:n.hasOwnProperty("thumbnail")?n.thumbnail.url:n.hasOwnProperty("full")?n.full.url:""});n.length&&_.each(n,function(e){t+='<li class="thumbnail"><img src="'+e+'"/></li>'}),this.ui.thumbnails.removeClass("is-loading").html(t)},getSelection:function(e){var t=wp.media.query({orderby:"post__in",order:"ASC",type:"image",post__in:e});return new wp.media.model.Selection(t.models,{props:t.props.toJSON(),multiple:!0})},ids:function(){var e=this.getSettingValue();return e?e.split(","):!1},restoreDefaultValue:function(){this.setSettingValue(this.getDefaultValue())}}),t.exports=i},{"./abstract-control":6}],13:[function(e,t,n){var i,o=Backbone.$,s=e("./abstract-control");i=s.extend({ui:{select:".button--select",change:".button--change",remove:".button--remove",icon:"i","default":".js-default"},events:{"click @ui.select":"openDialog","click @ui.change":"openDialog","click @ui.remove":"removeIcon","click @ui.icon":"openDialog","click @ui.default":"restoreDefaultValue"},addEventListeners:function(){this.listenTo(this.model.setting,"change",this.render),this.listenTo(this.model.setting.collection,"change",this.checkDependencies)},openDialog:function(){var e=this,t={title:"Select Icon",button:window._l10n.select,content:function(){var t=window._kits||{},n=e.getSettingValue();return _.keys(t).length?_.template(document.getElementById("tmpl-tailor-control-icon-select").innerHTML)({kits:t,value:n}):document.getElementById("tmpl-tailor-control-icon-empty").innerHTML},onOpen:function(){var e=this.$el,t=e.find("li"),n=e.find(".icon-kit");this.$el.find(".search--icon").on("input",function(e){var n=this.value.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&");n=n.replace(/ /g,")(?=.*");var i=new RegExp("^(?=.*"+n+").+","i");t.each(function(){this.classList.toggle("is-hidden",!i.test(this.getAttribute("title")))})}),this.$el.find(".select--icon").on("change",function(e){var t=this.value;n.removeClass("is-hidden").filter(function(){return this.id!=t}).addClass("is-hidden")})},onValidate:function(){return o("input[name=icon]:checked").val()},onSave:function(){e.setSettingValue(o("input[name=icon]:checked").val())},onClose:function(){this.$el.find(".search--icon").off("input")}};app.channel.trigger("dialog:open",t)},removeIcon:function(){this.setSettingValue("")}}),t.exports=i},{"./abstract-control":6}],14:[function(e,t,n){var i,o=(Backbone.$,e("./abstract-control"));i=o.extend({ui:{select:".button--select",change:".button--change",remove:".button--remove","default":".js-default",thumbnails:".thumbnails",thumbnail:".thumbnail"},events:{"click @ui.select":"openFrame","click @ui.change":"openFrame","click @ui.remove":"removeImage","click @ui.thumbnail":"openFrame","click @ui.default":"restoreDefaultValue"},initialize:function(e){this.frame=wp.media({states:[new wp.media.controller.Library({title:"Select Image",library:wp.media.query({type:["image"]}),multiple:!1,date:!1})]}),this.addEventListeners(),this.checkDependencies(this.model.setting)},addEventListeners:function(){this.listenTo(this.model.setting,"change",this.render),this.listenTo(this.model.setting.collection,"change",this.checkDependencies),this.frame.on("select",this.selectImage.bind(this))},openFrame:function(){this.frame.open()},selectImage:function(){var e=this.frame.state().get("selection"),t=e.first(),n=t.get("sizes");this.setSettingValue(t.get("id")),this.updateThumbnail(n)},updateThumbnail:function(e){var t;if(e.hasOwnProperty("medium"))t=e.medium.url;else if(e.hasOwnProperty("thumbnail"))t=e.thumbnail.url;else{if(!e.hasOwnProperty("full"))return;t=e.full.url}this.ui.thumbnails.removeClass("is-loading").html('<li class="thumbnail"><img src="'+t+'"/></li>')},removeImage:function(){this.setSettingValue("")},onRender:function(){var e=this,t=this.getSettingValue();if(t){var n=wp.media.attachment(t),i=n.get("sizes");i?this.updateThumbnail(i):n.fetch({success:function(){i=n.get("sizes"),e.updateThumbnail(i)}})}},onDestroy:function(){this.frame.off().dispose()}}),t.exports=i},{"./abstract-control":6}],15:[function(e,t,n){var i,o=Backbone.$,s=e("./abstract-control");i=s.extend({ui:{input:"input",select:".button--select","default":".js-default"},events:{"input @ui.input":"onControlChange","change @ui.input":"onControlChange","click @ui.select":"openDialog","click @ui.default":"restoreDefaultValue"},serializeData:function(){var e=Backbone.Marionette.ItemView.prototype.serializeData.apply(this,arguments),t=this.getDefaultValue();return e.value=this.getSettingValue(),e.placeholder=this.model.get("placeholder"),e.showDefault=null!=t&&e.value!=t,e},search:function(e){var t=this,n=this.$el.find(".search-results");if(n.length){t.$el.addClass("is-searching");var i={data:{s:e,nonce:window._nonces.query},success:function(e){n.html(e)},error:function(e){console.log(arguments)},complete:function(){t.$el.removeClass("is-searching")}};window.ajax.send("tailor_get_links",i)}},openDialog:function(){var e=this,t={title:"Select content",button:window._l10n.select,content:function(){return'<div class="dialog__container"><input class="search--content" type="search" role="search" placeholder="Search"><span class="spinner"></span><div class="search-results"></div></div>'},onOpen:function(){var t,n=this,i="",s=3;this.$el.find(".search--content").on("input",function(a){clearTimeout(t);var l=this.value;l.length>=s&&i!=o.trim(l)&&(t=setTimeout(o.proxy(e.search,n,l),500))})},onValidate:function(){return o("input[name=url]:checked").val()},onSave:function(){var t=o("input[name=url]:checked").val();e.setSettingValue(t),e.ui.input.val(t)},onClose:function(){this.$el.find(".search--content").off("input")}};app.channel.trigger("dialog:open",t)},removeIcon:function(){this.setSettingValue("")},onRestoreDefault:function(){this.render()}}),t.exports=i},{"./abstract-control":6}],16:[function(e,t,n){t.exports=Marionette.ItemView.extend({template:"#tmpl-tailor-control-list-empty"})},{}],17:[function(e,t,n){var i;Backbone.$;i=Marionette.CompositeView.extend({tagName:"li",className:"list-item",ui:{title:".list-item__title",content:".list-item__content","delete":".js-delete-list-item",close:".js-close-list-item"},triggers:{"click @ui.title":"toggle","click @ui.close":"toggle","click @ui.delete":"delete"},events:{keypress:"onKeyPress"},getChildView:function(e){return window.Tailor.Controls.lookup(e.get("type"))},childViewContainer:"#controls",template:"#tmpl-tailor-control-list-item",initialize:function(e){this.settings=e.settings,this._open=!1,this.model.startTracking(),this.addEventListeners()},addEventListeners:function(){this.listenTo(this.settings,"change",this.onChangeSettings),this.listenTo(app.channel,"modal:apply",this.onApplyModal),this.listenTo(app.channel,"modal:close",this.onCloseModal)},updateTitle:function(e,t){this.ui.title.find(":contains("+e+")").html(t)},onKeyPress:function(e){13===e.which&&this.triggerMethod("toggle")},onToggle:function(){this._open?this.slideUp():this.slideDown()},slideUp:function(){var e=this;e._open=!1,e.ui.content.slideUp(150,function(){e.el.classList.remove("is-open")})},slideDown:function(){var e=this;e._open=!0,e.ui.content.slideDown(150,function(){e.el.classList.add("is-open")})},onDelete:function(){var e=this;e.$el.slideUp(250,function(){e.triggerMethod("remove")})},onChangeSettings:function(e){var t=_.clone(this.model.get("atts")),n=e.get("id"),i=e.get("value");"title"==n&&this.updateTitle(t.title,i),t[n]=i,this.model.set("atts",t)},onApplyModal:function(){this.model.stopTracking()},onCloseModal:function(){this.model.resetAttributes()}}),t.exports=i},{}],18:[function(e,t,n){var i;Backbone.$;i=Marionette.CompositeView.extend({
    childView:e("./list-item"),childViewContainer:"#list-items",emptyView:e("./list-empty"),className:function(){return"control control--"+this.model.get("type")},ui:{button:".js-add"},events:{"click @ui.button":"addItem"},collectionEvents:{add:"updateContent",remove:"updateContent",change:"updateContent"},childEvents:{remove:"deleteItem",toggle:"onToggleItem"},template:"#tmpl-tailor-control-list",serializeData:function(){var e=Backbone.Marionette.ItemView.prototype.serializeData.apply(this,arguments);return e.childLabel=this.child.get("label").toLowerCase(),e},childViewOptions:function(e,t){var n=app.channel.request("sidebar:controls",e),i=app.channel.request("sidebar:settings",e),o={model:e,collection:n,settings:i};return o},initialize:function(e){this.element=e.element,this._added=[],this._deleted=[];var t=app.channel.request("sidebar:library",this.element.get("tag"));this.child=app.channel.request("sidebar:library",t.get("child")),this.addEventListeners()},addEventListeners:function(){this.listenTo(app.channel,"modal:apply",this.onApplyModal),this.listenTo(app.channel,"modal:close",this.onCloseModal)},filter:function(e,t,n){return e.get("parent")==this.element.get("id")},onRender:function(){var e=this;this.sortable=Sortable.create(this.$childViewContainer.get(0),{draggable:".list-item",handle:".list-item__title",animation:250,onEnd:function(t){app.channel.trigger("list:change:order",e.el),e.updateOrder()}})},isEmpty:function(){return 0==this.collection.getChildren(this.element).length},onToggleItem:function(e){this.children.each(function(t){t!==e&&t.slideUp()},this)},onAddChild:function(e){this.children.each(function(t){t!==e&&t.slideUp()},this)},addItem:function(){var e=this.collection.getChildren(this.element).length,t=_.first(this.collection.create([{tag:this.child.get("tag"),parent:this.element.get("id"),order:e,atts:{title:this.child.get("label")}}],{}));this._added.push(t)},deleteItem:function(e){for(var t=0;t<this._added.length;t++)this._added[t]==e.model&&this._added.splice(t,1);this.collection.remove(e.model),this._deleted.push(e.model)},onApplyModal:function(){this._deleted=[],this._added=[]},onCloseModal:function(){this.collection.add(this._deleted),this.collection.remove(this._added)},updateOrder:function(){this.children.each(function(e){e.model.set("order",e.$el.index())},this),this.collection.sort({silent:!0}),this.updateContent()},updateContent:function(){var e=this.generateShortcode();this.model.setting.set("value",e)},generateShortcode:function(){var e=this,t="",n=this.element.get("id"),i=this.collection.filter(function(t){return t.get("parent")===n&&!e._deleted.hasOwnProperty(t.cid)});return _.each(i,function(e){t+=e.toShortcode()}),t},onBeforeDestroy:function(){this.sortable.destroy(),this.collection.sort()}}),t.exports=i},{"./list-empty":16,"./list-item":17}],19:[function(e,t,n){var i,o=(Backbone.$,e("./abstract-control"));i=o.extend({ui:{input:"input","default":".js-default"},templateHelpers:{checked:function(e){return this.value===e?"checked":""}},addEventListeners:function(){this.listenTo(this.model.setting,"change",this.render),this.listenTo(this.model.setting.collection,"change",this.checkDependencies)},onControlChange:function(e){this.setSettingValue(this.ui.input.filter(":checked").val())}}),t.exports=i},{"./abstract-control":6}],20:[function(e,t,n){var i,o=(Backbone.$,e("./abstract-control"));i=o.extend({ui:{range:"input[type=range]",input:"input[type=text]","default":".js-default"},events:{"input @ui.range":"onControlChange","change @ui.input":"onControlChange","click @ui.default":"restoreDefaultValue"},onControlChange:function(e){var t=e.target.value;this.ui.input.val(t),this.ui.range.val(t),this.setSettingValue(t)},restoreDefaultValue:function(e){this.setSettingValue(this.getDefaultValue()),this.render()}}),t.exports=i},{"./abstract-control":6}],21:[function(e,t,n){var i,o=(Backbone.$,e("./abstract-control"));i=o.extend({ui:{input:"select","default":".js-default"},templateHelpers:{selected:function(e){var t=this.value.split(",");return-1!==t.indexOf(e)?"selected":""}},onRender:function(){this.ui.input.select2()},onControlChange:function(e){for(var t=this.ui.input.get(0),n=[],i=0;i<t.length;i++)t[i].selected&&n.push(t[i].value);this.setSettingValue(n.join(","))},restoreDefaultValue:function(e){this.setSettingValue(this.getDefaultValue()),this.render()},onDestroy:function(){this.ui.input.select2("destroy")}}),t.exports=i},{"./abstract-control":6}],22:[function(e,t,n){var i,o=(Backbone.$,e("./abstract-control"));i=o.extend({ui:{input:"select","default":".js-default"},addEventListeners:function(){this.listenTo(this.model.setting,"change",this.render),this.listenTo(this.model.setting.collection,"change",this.checkDependencies)}}),t.exports=i},{"./abstract-control":6}],23:[function(e,t,n){var i,o=(Backbone.$,e("./abstract-control"));i=o.extend({ui:{input:"input","default":".js-default"},serializeData:function(){var e=Backbone.Marionette.ItemView.prototype.serializeData.apply(this,arguments),t=this.getDefaultValue();e.value=this.getSettingValue(),e.showDefault=null!=t&&e.value!=t,e.choices=[];var n=e.value.split("-"),i=this.model.get("choices");for(var o in i)i.hasOwnProperty(o)&&(e.choices[i[o]]=n.shift()||"");return e},onControlChange:function(e){var t=[];_.each(this.ui.input,function(e,n){t.push(e.value)},this),this.setSettingValue(t.join("-"))},restoreDefaultValue:function(e){this.setSettingValue(this.getDefaultValue()),this.render()}}),t.exports=i},{"./abstract-control":6}],24:[function(e,t,n){var i,o=(Backbone.$,e("./abstract-control"));i=o.extend({ui:{input:"input","default":".js-default"},templateHelpers:{checked:function(){return this.value?"checked":""}},onControlChange:function(e){this.setSettingValue(this.ui.input.get(0).checked?1:"")},restoreDefaultValue:function(e){this.setSettingValue(this.getDefaultValue()),this.render()}}),t.exports=i},{"./abstract-control":6}],25:[function(e,t,n){var i,o=(Backbone.$,e("./abstract-control"));i=o.extend({ui:{input:"input","default":".js-default"},templateHelpers:{inputAttrs:function(){var e="";return _.each(this.attrs,function(t,n){e+=n+'="'+t+'"'}),e}},serializeData:function(){var e=Backbone.Marionette.ItemView.prototype.serializeData.apply(this,arguments),t=this.getDefaultValue();return e.value=this.getSettingValue(),e.showDefault=null!=t&&e.value!=t,e.attrs=this.model.get("input_attrs"),e},onRestoreDefault:function(){this.render()}}),t.exports=i},{"./abstract-control":6}],26:[function(e,t,n){var i,o=(Backbone.$,e("./abstract-control"));i=o.extend({ui:{input:"textarea","default":".js-default"},onRestoreDefault:function(){this.render()}}),t.exports=i},{"./abstract-control":6}],27:[function(e,t,n){var i,o=(Backbone.$,e("./abstract-control"));i=o.extend({ui:{select:".button--select",change:".button--change",remove:".button--remove","default":".js-default",preview:".video-preview"},events:{"click @ui.select":"openFrame","click @ui.change":"openFrame","click @ui.remove":"removeVideo","click @ui.default":"restoreDefaultValue"},initialize:function(e){this.frame=wp.media({states:[new wp.media.controller.Library({title:"Select Video",library:wp.media.query({type:["video"]}),multiple:!1,date:!1})]}),this.addEventListeners(),this.checkDependencies(this.model.setting)},addEventListeners:function(){this.listenTo(this.model.setting,"change",this.render),this.listenTo(this.model.setting.collection,"change",this.checkDependencies),this.listenTo(this.frame,"select",this.selectVideo)},openFrame:function(){this.frame.open()},selectVideo:function(){var e=this.frame.state().get("selection"),t=e.first();this.setSettingValue(t.get("id")),this.updatePreview(t)},updatePreview:function(e){var t=e.get("url"),n=e.get("mime");this.ui.preview.removeClass("is-loading").html('<video controls><source src="'+t+'" type="'+n+'"></video>')},removeVideo:function(){this.setSettingValue("")},onRender:function(){var e=this,t=this.getSettingValue();if(t){var n=wp.media.attachment(t);n.get("url")?e.updatePreview(n):n.fetch({success:function(){e.updatePreview(n)}})}},onDestroy:function(){this.frame.dispose()},initializePlayer:function(){var e=window._wpmejsSettings||{},t=this.ui.preview.get(0).firstChild;this.player=new MediaElementPlayer(t,e)},destroyPlayer:function(){this.player&&wp.media.mixin.removePlayer(this.player)}}),t.exports=i},{"./abstract-control":6}],28:[function(e,t,n){var i,o=Backbone.$;i=Marionette.ItemView.extend({events:{click:"onClick",keypress:"onKeyPress"},modelEvents:{focus:"onFocus"},template:"#tmpl-tailor-panel-default-item",attachElContent:function(e){var t=o(e);return this.$el.replaceWith(t),this.setElement(t),this.el.setAttribute("tabindex",0),this},onClick:function(){this.triggerMethod("show:section")},onKeyPress:function(e){13===e.which&&this.triggerMethod("show:section")},onFocus:function(){this.el.focus()}}),t.exports=i},{}],29:[function(e,t,n){var i,o=Backbone.$;i=Marionette.ItemView.extend({events:{click:"restore",keypress:"onKeyPress"},template:"#tmpl-tailor-panel-history-item",initialize:function(){this.addEventListeners()},addEventListeners:function(){this.listenTo(this.model.collection,"change:active",this.toggleClass)},onRender:function(){this.toggleClass()},attachElContent:function(e){var t=o(e);return this.$el.replaceWith(t),this.setElement(t),this.el.setAttribute("tabindex",0),this},onKeyPress:function(e){13===e.which&&this.restore()},restore:function(){var e=this.model.get("timestamp");app.channel.trigger("before:history:restore",e),app.channel.trigger("history:restore",e)},toggleClass:function(e){e=e||this.model.collection.getActive(),this.$el.toggleClass("is-active",e===this.model)}}),t.exports=i},{}],30:[function(e,t,n){var i,o=Backbone.$;i=Marionette.ItemView.extend({events:{click:"onClick",keypress:"onKeyPress"},modelEvents:{"change:match":"onSearch"},behaviors:{Draggable:{}},onClick:function(){var e=this.el;if(!e.classList.contains("is-inactive")){var t=function(n){e.removeEventListener(window.animationEndName,t),e.classList.remove("shake")};Modernizr.cssanimations&&(e.addEventListener(window.animationEndName,t),e.classList.add("shake")),Tailor.Notify(window._l10n.dragElement,"warning")}},getTemplate:function(){return"#tmpl-tailor-panel-library-item"},attachElContent:function(e){var t=o(e);return this.$el.replaceWith(t),this.setElement(t),this},onSearch:function(e){this.el.style.display=e.get("match")?"block":"none"}}),t.exports=i},{}],31:[function(e,t,n){var i,o=Backbone.$;i=Marionette.ItemView.extend({events:{click:"onClick",keypress:"onKeyPress"},modelEvents:{focus:"onFocus"},template:"#tmpl-tailor-panel-default-item",attachElContent:function(e){var t=o(e);return this.$el.replaceWith(t),this.setElement(t),this.el.setAttribute("tabindex",0),this},onClick:function(){this.triggerMethod("show:panel")},onKeyPress:function(e){13===e.which&&this.triggerMethod("show:panel")},onFocus:function(){this.el.focus()}}),t.exports=i},{}],32:[function(e,t,n){var i,o=Backbone.$;i=Marionette.ItemView.extend({ui:{"delete":".js-delete-template",download:".js-download-template",preview:".js-preview-template"},events:{click:"onClick"},modelEvents:{"change:match":"onSearch"},behaviors:{Draggable:{}},onClick:function(e){switch(e.target){case this.ui.download.get(0):this.download();break;case this.ui["delete"].get(0):this["delete"]();break;case this.ui.preview.get(0):this.preview();break;default:var t=this.el,n=function(e){t.removeEventListener(window.animationEndName,n),t.classList.remove("shake")};Modernizr.cssanimations&&(t.addEventListener(window.animationEndName,n),t.classList.add("shake")),Tailor.Notify(window._l10n.dragTemplate,"warning")}},getTemplate:function(){return"#tmpl-tailor-panel-templates-item"},attachElContent:function(e){var t=o(e);return this.$el.replaceWith(t),this.setElement(t),this.el.setAttribute("tabindex",0),this},download:function(){var e=this,t=e.model.get("id"),n={data:{template_id:t,nonce:window._nonces.loadTemplate},success:function(n){var i=e.model,o=n.models,s=i.get("label");t=s.replace(" ","-").toLowerCase();var a={id:t,label:s,tag:i.get("tag"),type:i.get("type"),models:o};a="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(a));var l=document.getElementById("download-template");l.setAttribute("href",a),l.setAttribute("download","tailor-template-"+t+"-"+Date.now()+".json"),l.click()}};window.ajax.send("tailor_load_template",n)},"delete":function(){var e=this,t={data:{id:e.model.get("id"),nonce:window._nonces.deleteTemplate},success:function(t){e.$el.slideUp(function(){e.model.trigger("destroy",e.model)}),app.channel.trigger("template:delete")}};window.ajax.send("tailor_delete_template",t)},preview:function(){window.open(window._urls.view+"?template_preview=1&template_id="+this.model.get("id"),"_blank")},onSearch:function(e){this.el.style.display=e.get("match")?"block":"none"}}),t.exports=i},{}],33:[function(e,t,n){var i;Backbone.$;i=Marionette.CompositeView.extend({ui:{backButton:".back-button"},triggers:{"click @ui.backButton":"back:home"},behaviors:{Panel:{}},emptyView:e("./panel-empty"),emptyViewOptions:function(){return{type:this.model.get("type")}},childViewContainer:"#items",getChildView:function(e){return window.Tailor.Items.lookup(this.model.get("type"))},filter:function(e,t,n){switch(this.model.get("type")){case"library":return!_.contains(["tailor_row"],e.get("tag"))&&!_.contains(["child","inline"],e.get("type"));case"default":return e.get("panel")===this.model.get("id");default:return!0}},getTemplate:function(){var e=this.model.get("type")||"default";return"#tmpl-tailor-panel-"+e},serializeData:function(){var e=Marionette.ItemView.prototype.serializeData.apply(this,arguments);return e.items=this.collection,e},onShow:function(){this.ui.backButton.get(0).focus()}}),t.exports=i},{"./panel-empty":34}],34:[function(e,t,n){t.exports=Marionette.ItemView.extend({className:"empty",initialize:function(e){this.type=e.type},getTemplate:function(){var e=this.type||"default";return"#tmpl-tailor-panel-"+e+"-empty"}})},{}],35:[function(e,t,n){var i;Backbone.$;i=Marionette.CompositeView.extend({ui:{backButton:".back-button",save:".js-save-template","import":".js-import-template",searchForm:".search-form"},events:{"click @ui.save":"save","click @ui.import":"import"},triggers:{"click @ui.backButton":"back:home"},behaviors:{Panel:{}},emptyView:e("./panel-empty"),emptyViewOptions:function(){return{type:this.model.get("type")}},template:"#tmpl-tailor-panel-templates",childViewContainer:"#items",getChildView:function(e){return window.Tailor.Items.lookup(this.model.get("type"))},serializeData:function(){var e=Marionette.ItemView.prototype.serializeData.apply(this,arguments);return e.items=this.collection,e},onShow:function(){this.ui.backButton.get(0).focus(),0===this.collection.length&&this.ui.searchForm.hide()},onAddChild:function(){this.ui.searchForm.show()},onRemoveChild:function(){0===this.collection.length&&this.ui.searchForm.hide()},"import":function(e){var t=this,n={title:window._l10n.importTemplate,content:document.querySelector("#tmpl-tailor-dialog-import-template").innerHTML,button:window._l10n["import"],onOpen:function(){this.el.querySelector("#import-template").focus()},onValidate:function(){var e=this.el.querySelector("#import-template"),t=/(?:\.([^.]+))?$/;return e.value&&"json"===t.exec(e.value)[1]},onSave:function(){var e=this.el.querySelector("#import-template"),n=e.files[0];if(!n||n.name.match(/.+\.json/)){var i=new FileReader;i.onload=function(e){var n={label:"",tag:"",models:[],nonce:window._nonces.saveTemplate},o=_.extend(n,JSON.parse(i.result));o.models=JSON.stringify(o.models),t.createTemplate(o,"import")};try{i.readAsText(n)}catch(o){}}},onClose:function(){t.ui["import"].focus()}};app.channel.trigger("dialog:open",n)},save:function(){var e,t=app.channel.request("canvas:element:selected"),n=app.channel.request("canvas:elements"),i=[];if(t&&"function"==typeof t.get){var o=function(e){_.each(n.where({parent:e}),function(e){i.push(e.toJSON()),o(e.get("id"))})};"child"==t.get("type")&&(t=t.collection.get(t.get("parent"))),o(t.get("id")),t=t.toJSON(),t.parent="",i.push(t),e=t.tag}else i=n.models,e="tailor_section";var s=this,a={title:window._l10n.saveTemplate,content:document.querySelector("#tmpl-tailor-dialog-save-template").innerHTML,button:window._l10n.save,onOpen:function(){this.el.querySelector("#save-template").focus()},onValidate:function(){var e=this.el.querySelector("#save-template");return e.value},onSave:function(){var t=this.el.querySelector("#save-template"),n={label:t.value,tag:e,models:JSON.stringify(i),nonce:window._nonces.saveTemplate};s.createTemplate(n,"save")},onClose:function(){s.ui.save.focus()}};app.channel.trigger("dialog:open",a)},createTemplate:function(e,t){t=t||"save";var n=this,i=n.collection;n.ui.save.prop("disabled",!0),n.ui["import"].prop("disabled",!0);var o={data:e,success:function(e){i.add({id:e.id,label:e.label,tag:e.tag,type:e.type}),app.channel.trigger("template:"+t)},complete:function(){n.ui.save.prop("disabled",!1),n.ui["import"].prop("disabled",!1)}};window.ajax.send("tailor_save_template",o)}}),t.exports=i},{"./panel-empty":34}],36:[function(e,t,n){var i;Backbone.$;i=Marionette.CompositeView.extend({ui:{backButton:".back-button"},triggers:{"click @ui.backButton":"back:panel"},behaviors:{Panel:{}},emptyView:e("./section-empty"),childViewContainer:"#controls",initialize:function(e){this.panel=e.panel},getChildView:function(e){return window.Tailor.Controls.lookup(e.get("type"))},filter:function(e,t,n){return"default"===this.model.get("type")?e.get("section")===this.model.get("id"):!0},getTemplate:function(){return"#tmpl-tailor-section-"+this.model.get("type")},serializeData:function(){var e=Marionette.ItemView.prototype.serializeData.apply(this,arguments);return e.panel=this.panel.get("title"),e},onShow:function(){this.ui.backButton.get(0).focus(),this.children.each(function(e){"code"===e.model.get("type")&&e.editor.refresh()},this)}}),t.exports=i},{"./section-empty":37}],37:[function(e,t,n){t.exports=Marionette.ItemView.extend({className:"empty",getTemplate:function(){var e=this.model.get("type")||"default";return"#tmpl-tailor-section-"+e+"-empty"}})},{}],38:[function(e,t,n){var i;Backbone.$;i=Backbone.Collection.extend({model:e("../models/control"),initialize:function(e,t){t&&t.settings&&(this.settings=t.settings),this.addEventListeners()},addEventListeners:function(){this.listenTo(this,"reset",this.onReset)},onReset:function(){this.settings&&this.each(function(e){var t=this.settings.findWhere({id:e.get("setting")});t&&(e.setting=t)},this)}}),t.exports=i},{"../models/control":45}],39:[function(e,t,n){var i,o=(Backbone.$,e("./searchable"));i=o.extend({model:function(e,t){var n=window.Tailor.Models.lookup(e.tag,e.type);return new n(e,t)},comparator:"label",getHaystack:function(e){return[e.get("label"),e.get("type"),e.get("description"),e.get("badge"),e.get("tag")].join(" ")}}),t.exports=i},{"./searchable":41}],40:[function(e,t,n){var i;Backbone.$;i=Backbone.Collection.extend({model:e("../models/panel")}),t.exports=i},{"../models/panel":49}],41:[function(e,t,n){var i;Backbone.$;i=Backbone.Collection.extend({doSearch:function(e){this.terms!==e&&(this.terms=e,this.terms.length>0&&this.search(this.terms),""===this.terms&&this.each(function(e){e.set("match",!0)}))},search:function(e){var t,n;e=e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"),e=e.replace(/ /g,")(?=.*"),t=new RegExp("^(?=.*"+e+").+","i"),this.each(function(e){n=this.getHaystack(e),e.set("match",t.test(n))},this)}}),t.exports=i},{}],42:[function(e,t,n){var i;Backbone.$;i=Backbone.Collection.extend({model:e("../models/section")}),t.exports=i},{"../models/section":50}],43:[function(e,t,n){var i;Backbone.$;i=Backbone.Collection.extend({model:e("../models/setting"),initialize:function(e,t){t&&t.element&&(this.element=t.element),this.addEventListeners()},addEventListeners:function(){this.listenTo(this,"reset",this.load)},load:function(){var e=this.element.get("atts");this.each(function(t){t.set("value",e[t.get("id")]||"")},this)}}),t.exports=i},{"../models/setting":51}],44:[function(e,t,n){var i,o=(Backbone.$,e("./searchable"));i=o.extend({model:e("../models/template"),comparator:"name",getHaystack:function(e){return[e.get("id"),e.get("label")].join(" ")}}),t.exports=i},{"../models/template":52,"./searchable":41}],45:[function(e,t,n){var i;i=Backbone.Model.extend({defaults:{id:"",label:"",description:"",type:"",choices:{},priority:0,setting:"",value:null,section:""}}),t.exports=i},{}],46:[function(e,t,n){var i;Backbone.$;i=Backbone.Model.extend({defaults:function(){return{label:"",description:"",tag:"",icon:"",sections:[],controls:[],type:"default",child:"",collection:"library"}},initialize:function(){this.addEventListeners()},addEventListeners:function(){this.listenTo(this,"element:add:top",this.insertBefore),this.listenTo(this,"element:add:bottom",this.insertAfter),this.listenTo(this,"element:add:left",this.columnBefore),this.listenTo(this,"element:add:right",this.columnAfter),this.listenTo(this,"element:add:center",this.createChild)},insertBefore:function(e){this.insertAtIndex(e.model,e.model.get("order")-1)},insertAfter:function(e){this.insertAtIndex(e.model,e.model.get("order"))},insertAtIndex:function(e,t){e.collection.create([{tag:this.get("tag"),label:this.get("label"),parent:e.get("parent"),type:this.get("type"),order:t}],{})},columnBefore:function(e){var t=e.model.get("parent");if("tailor_column"==e.model.get("tag")){var n=e.model.collection.createColumn(t,e.model.get("order")-1);e.model.collection.create([{tag:this.get("tag"),label:this.get("label"),parent:n.get("id"),type:this.get("type"),order:0}],{at:0})}else{var i=e.model.collection.createRow(t,e.model.get("order"));e.model.collection.create([{tag:this.get("tag"),label:this.get("label"),parent:_.first(i).get("id"),type:this.get("type"),order:0}],{at:0}),e.model.collection.insertChild(e.model,_.last(i))}},columnAfter:function(e){var t=e.model.get("parent");if("tailor_column"==e.model.get("tag")){var n=e.model.collection.createColumn(t,e.model.get("order"));e.model.collection.create([{tag:this.get("tag"),label:this.get("label"),parent:n.get("id"),type:this.get("type"),order:0}],{at:0})}else{var i=e.model.collection.createRow(t,e.model.get("order"));e.model.collection.create([{tag:this.get("tag"),label:this.get("label"),parent:_.last(i).get("id"),type:this.get("type"),order:0}],{at:0}),e.model.collection.insertChild(e.model,_.first(i))}},createChild:function(e){var t=e.model.get("id"),n=e.model.get("child"),i=e.model.collection.where({parent:t,tag:n}).length,o=e.model.collection.createWrapper(n,t,i,!1);e.model.collection.create([{tag:this.get("tag"),label:this.get("label"),parent:o.get("id"),type:this.get("type"),order:0}],{at:0})}}),t.exports=i},{}],47:[function(e,t,n){var i;Backbone.$;i=Backbone.Model.extend({defaults:function(){return{label:"",description:"",tag:"",icon:"",sections:[],controls:[],type:"default",child:"",collection:"library"}},initialize:function(){this.addEventListeners()},addEventListeners:function(){this.listenTo(this,"element:add:top",this.insertBefore),this.listenTo(this,"element:add:bottom",this.insertAfter),this.listenTo(this,"element:add:left",this.columnBefore),this.listenTo(this,"element:add:right",this.columnAfter)},insertBefore:function(e){this.insertAtIndex(e.model,e.model.get("order"))},insertAfter:function(e){this.insertAtIndex(e.model,e.model.get("order")+1)},insertAtIndex:function(e,t){var n="tailor_content",i=e.collection.create([{tag:n,atts:{}},{tag:n,atts:{}}],{silent:!0});e.collection.createContainer(this,e.get("parent"),t,i)},columnBefore:function(e){var t,n=e.model.get("parent"),i="tailor_content";if("tailor_column"==e.model.get("tag")){var o=e.model.collection.createColumn(n,e.model.get("order")-1);t=e.model.collection.create([{tag:i,atts:{}},{tag:i,atts:{}}],{silent:!0}),e.model.collection.createContainer(this,o.get("id"),0,t)}else{var s=e.model.collection.createRow(n,e.model.get("order"));e.model.collection.insertChild(e.model,_.last(s)),t=e.model.collection.create([{tag:i,atts:{}},{tag:i,atts:{}}],{silent:!0}),e.model.collection.createContainer(this,_.first(s).get("id"),0,t)}},columnAfter:function(e){var t,n=e.model.get("parent"),i="tailor_content";if("tailor_column"==e.model.get("tag")){var o=e.model.collection.createColumn(n,e.model.get("order"));t=e.model.collection.create([{tag:i,atts:{}},{tag:i,atts:{}}],{silent:!0}),e.model.collection.createContainer(this,o.get("id"),0,t)}else{var s=e.model.collection.createRow(n,e.model.get("order"));e.model.collection.insertChild(e.model,_.first(s)),t=e.model.collection.create([{tag:i,atts:{}},{tag:i,atts:{}}],{silent:!0}),e.model.collection.createContainer(this,_.last(s).get("id"),0,t)}}}),t.exports=i},{}],48:[function(e,t,n){var i;Backbone.$;i=Backbone.Model.extend({defaults:function(){return{label:"",description:"",tag:"",icon:"",sections:[],controls:[],type:"default",child:"",collection:"library"}},initialize:function(){this.addEventListeners()},addEventListeners:function(){this.listenTo(this,"element:add:top",this.insertBefore),this.listenTo(this,"element:add:bottom",this.insertAfter),this.listenTo(this,"element:add:left",this.columnBefore),this.listenTo(this,"element:add:right",this.columnAfter),this.listenTo(this,"element:add:center",this.createChild)},insertBefore:function(e){this.insertAtIndex(e.model,e.model.get("order")-1)},insertAfter:function(e){this.insertAtIndex(e.model,e.model.get("order"))},insertAtIndex:function(e,t){e.collection.createWrapper(this.get("tag"),e.get("parent"),t)},columnBefore:function(e){var t=e.model.get("parent"),n=e.model.get("order")-1;if("tailor_column"==e.model.get("tag")){var i=e.model.collection.createColumn(t,n);e.model.collection.createWrapper(this.get("tag"),i.get("id"),0)}else{var o=e.model.collection.createRow(t,n);e.model.collection.insertChild(e.model,_.last(o)),e.model.collection.createWrapper(this.get("tag"),_.first(o).get("id"),0)}},columnAfter:function(e){var t=e.model.get("parent"),n=e.model.get("order");if("tailor_column"==e.model.get("tag")){var i=e.model.collection.createColumn(t,n);e.model.collection.createWrapper(this.get("tag"),i.get("id"),0)}else{var o=e.model.collection.createRow(t,n);e.model.collection.insertChild(e.model,_.first(o)),e.model.collection.createWrapper(this.get("tag"),_.last(o).get("id"),0)}},createChild:function(e){var t=e.model.get("id"),n=e.model.get("child"),i=e.model.collection.where({parent:t,tag:n}).length,o=e.model.collection.createWrapper(n,t,i,!1);e.model.collection.createWrapper(this.get("tag"),o.get("id"),0)}}),t.exports=i},{}],49:[function(e,t,n){var i;i=Backbone.Model.extend({defaults:{id:"",title:"",description:"",collection:"",priority:0}}),t.exports=i},{}],50:[function(e,t,n){var i;i=Backbone.Model.extend({defaults:{id:"",title:"",description:"",priority:0,panel:""}}),t.exports=i},{}],51:[function(e,t,n){var i;i=Backbone.Model.extend({defaults:{id:"",type:"",value:"","default":null}}),t.exports=i},{}],52:[function(e,t,n){var i;i=Backbone.Model.extend({defaults:function(){return{id:this.cid,label:"",collection:"template"}},initialize:function(){this.addEventListeners()},addEventListeners:function(){this.listenTo(this,"element:add:top",this.insertBefore),this.listenTo(this,"element:add:bottom",this.insertAfter),this.listenTo(this,"element:add:left",this.columnBefore),this.listenTo(this,"element:add:right",this.columnAfter),this.listenTo(this,"element:add:center",this.createChild)},createChild:function(e){var t=e.model.get("id"),n=e.model.get("child"),i=e.model.collection.where({parent:t,tag:n}).length,o=e.model.collection.createWrapper(n,t,i,!1);app.channel.trigger("template:load",this,o.get("id"),0)},columnBefore:function(e){var t=e.model.get("parent");if("tailor_column"==e.model.get("tag")){var n=e.model.collection.createColumn(t,e.model.get("order")-1);app.channel.trigger("template:load",this,n.get("id"),0)}else{var i=e.model.collection.createRow(t,e.model.get("order"));app.channel.trigger("template:load",this,_.first(i).get("id"),0),e.model.collection.insertChild(e.model,_.last(i))}},columnAfter:function(e){var t=e.model.get("parent");if("tailor_column"==e.model.get("tag")){var n=e.model.collection.createColumn(t,e.model.get("order"));app.channel.trigger("template:load",this,n.get("id"),0)}else{var i=e.model.collection.createRow(t,e.model.get("order"));app.channel.trigger("template:load",this,_.last(i).get("id"),0),e.model.collection.insertChild(e.model,_.first(i))}},insertBefore:function(e){app.channel.trigger("template:load",this,e.model.get("parent"),e.model.get("order")-1)},insertAfter:function(e){app.channel.trigger("template:load",this,e.model.get("parent"),e.model.get("order"))}}),t.exports=i},{}],53:[function(e,t,n){Tailor.Collections=Tailor.Collections||{},Tailor.Collections.Library=e("./collections/library"),Tailor.Collections.Template=e("./collections/templates"),Tailor.Collections.Panel=e("./collections/panels"),Tailor.Collections.Section=e("./collections/sections"),Tailor.Collections.Setting=e("./collections/settings"),Tailor.Collections.Control=e("./collections/controls"),t.exports=Marionette.Module.extend({onBeforeStart:function(e){var t=this,n=new Tailor.Collections.Library(e.library),i=new Tailor.Collections.Template(e.templates);t.panels=new Tailor.Collections.Panel(e.panels),t.sections={sidebar:new Tailor.Collections.Section(e.sections)},t.settings={sidebar:new Tailor.Collections.Setting(e.settings)},t.controls={sidebar:new Tailor.Collections.Control(e.controls,{silent:!1,settings:t.settings.sidebar})};var o={getLibraryItems:function(e){return e?n.findWhere({tag:e}):n},getTemplates:function(){return i},getPanels:function(e){return e?t.panels.findWhere({id:e}):t.panels},getSections:function(e){if(!e)return t.sections.sidebar;var n=e.cid;if(!t.sections.hasOwnProperty(n)){var i=app.channel.request("sidebar:library",e.get("tag")),o=i.get("sections")||[];t.sections[n]=new Tailor.Collections.Section(o)}return t.sections[n]},getControls:function(e){if(!e)return t.controls.sidebar;var n=e.cid;if(!t.controls.hasOwnProperty(n)){var i=app.channel.request("sidebar:library",e.get("tag")),s=i.get("controls")||[],a=o.getSettings(e),l={silent:!1,settings:a};t.controls[n]=new Tailor.Collections.Control(s,l)}return t.controls[n]},getSettings:function(e){if(!e)return t.settings.sidebar;var n=e.cid;if(!t.settings.hasOwnProperty(n)){var i=app.channel.request("sidebar:library",e.get("tag")),o=i.get("settings")||[];t.settings[n]=new Tailor.Collections.Setting(o,{element:e})}return t.settings[n].load(),t.settings[n]}};app.channel.reply("sidebar:library",o.getLibraryItems),app.channel.reply("sidebar:templates",o.getTemplates),app.channel.reply("sidebar:panels",o.getPanels),app.channel.reply("sidebar:sections sidebar:default",o.getSections),app.channel.reply("sidebar:controls",o.getControls),app.channel.reply("sidebar:settings",o.getSettings),this.listenTo(t.settings.sidebar,"change",this.onChangeSetting)},onChangeSetting:function(e){app.channel.trigger("sidebar:setting:change",e)}})},{"./collections/controls":38,"./collections/library":39,"./collections/panels":40,"./collections/sections":42,"./collections/settings":43,"./collections/templates":44}],54:[function(e,t,n){t.exports=Marionette.Module.extend({onStart:function(){var t=e("./dialog/show/dialog"),n={showDialog:function(e){app.dialog.show(new t(e))}};this.listenTo(app.channel,"dialog:open",n.showDialog)}})},{"./dialog/show/dialog":56}],55:[function(e,t,n){t.exports=Backbone.Marionette.Region.extend({initialize:function(){this.$overlay=jQuery('<div id="overlay"></div>')},onShow:function(e,t,n){this.el.classList.add("is-visible"),this.$overlay.on("click",jQuery.proxy(this.empty,this)).appendTo("body")},onEmpty:function(e,t,n){this.el.classList.remove("is-visible"),this.$overlay.off().detach()}})},{}],56:[function(e,t,n){var i;window.jQuery;i=Backbone.Marionette.ItemView.extend({className:"dialog",defaults:{title:"",content:"",button:""},ui:{close:".js-close",content:".dialog__content",save:".js-save"
},events:{input:"onChange",change:"onChange"},triggers:{"click @ui.close":"close","click @ui.save":"save"},template:"#tmpl-tailor-dialog",serializeData:function(){return{title:this.title,content:this.content,button:this.button}},initialize:function(e){this.title=e.title||this.defaults.title,this.content=e.content||this.defaults.content,this.button=e.button||this.defaults.button,this.callbacks={validate:e.onValidate,open:e.onOpen,save:e.onSave,close:e.onClose}},onBeforeRender:function(){"function"==typeof this.content&&(this.content=this.content.call(this))},onDomRefresh:function(){"function"==typeof this.callbacks.open&&this.callbacks.open.call(this),this.validate()},onChange:function(){this.validate()},validate:function(){"function"==typeof this.callbacks.validate&&this.ui.save.prop("disabled",!this.callbacks.validate.call(this))},onSave:function(){"function"==typeof this.callbacks.save&&this.callbacks.save.call(this),this.onClose()},onClose:function(){"function"==typeof this.callbacks.close&&this.callbacks.close.call(this),this.triggerMethod("destroy")}}),t.exports=i},{}],57:[function(e,t,n){t.exports=Marionette.Module.extend({onStart:function(){var t=e("./modal/show/modal"),n={openModal:function(e){if(app.modal.hasView()){if(e===app.modal.currentView.model)return;app.modal.currentView.triggerMethod("close")}app.modal.show(new t({model:e}))},closeModal:function(){app.modal.empty()}};this.listenTo(app.channel,"modal:open",n.openModal),this.listenTo(app.channel,"elements:reset",n.closeModal)}})},{"./modal/show/modal":61}],58:[function(e,t,n){t.exports=Backbone.Marionette.Region.extend({onShow:function(e,t,n){this.el.classList.add("is-visible");var i=this.el.getBoundingClientRect(),o=this.el.style.width?this.el.style.width:i.width;this.el.style.width=o+"px",this.el.style.height||(this.el.style.height=window.innerHeight-80+"px"),this.el.style.top||(this.el.style.top="40px"),this.el.style.left||(document.documentElement.dir&&"rtl"==document.documentElement.dir?this.el.style.left="40px":this.el.style.left=window.innerWidth-(i.width+40)+"px"),this.updateClassName(o),this.listenTo(e,"modal:resize",this.onResize)},onResize:function(e,t){this.updateClassName(e)},updateClassName:function(e){this.$el.toggleClass("is-x-small",480>e).toggleClass("is-small",e>481&&767>e).toggleClass("is-medium",e>768&&979>e).toggleClass("is-large",e>980&&1199>e).toggleClass("is-x-large",e>=1200)},onEmpty:function(e,t,n){this.el.classList.remove("is-visible"),this.stopListening(e,"modal:resize",this.onResize)}})},{}],59:[function(e,t,n){t.exports=Marionette.ItemView.extend({className:"tailor-empty",template:"#tmpl-tailor-modal-empty"})},{}],60:[function(e,t,n){t.exports=Marionette.ItemView.extend({className:"tailor-empty",template:"#tmpl-tailor-section-default-empty"})},{}],61:[function(e,t,n){var i;window.jQuery;i=Marionette.LayoutView.extend({className:"modal",ui:{close:".js-close",preview:".js-preview",apply:".js-apply"},behaviors:{Resizable:{ui:{handle:".modal__title"}}},triggers:{"click @ui.close":"close","click @ui.preview":"preview","click @ui.apply":"apply"},modelEvents:{destroy:"destroy"},template:"#tmpl-tailor-modal",regions:{tabs:"#tailor-modal-tabs",sections:"#tailor-modal-sections"},initialize:function(e){this.isModified=!1,this.settings=app.channel.request("sidebar:settings",this.model),this.addEventListeners(),app.channel.trigger("modal:initialize",this,this.model)},addEventListeners:function(){this.listenTo(this.settings,"change",this.onChange)},onRender:function(){var t=app.channel.request("sidebar:sections",this.model),n=app.channel.request("sidebar:controls",this.model),i=e("./sections");if(this.showChildView("sections",new i({element:this.model,collection:t,controls:n})),t.length>1){var o=e("./tabs");this.showChildView("tabs",new o({collection:t})),this.el.classList.add("has-sections")}this.model.collection.trigger("edit",this.model,!0)},onShow:function(){this.ui.close.focus()},onChange:function(){this.isModified=!0,this.ui.preview.attr("disabled",!1),this.ui.apply.attr("disabled",!1)},onPreview:function(){this.model.isTracking()||this.model.startTracking(),this.model.set("atts",this._getAttributes()),this.ui.preview.attr("disabled",!0),app.channel.trigger("modal:preview",this,this.model)},onApply:function(){this.model.stopTracking(),this.model.set("atts",this._getAttributes()),app.channel.trigger("modal:apply",this,this.model),this.triggerMethod("destroy")},onClose:function(){if(this.isModified){var e=confirm("You have made changes to this element.  Would you like to apply them?");!0===e?this.triggerMethod("apply"):this.model.resetAttributes()}app.channel.trigger("modal:close",this),this.triggerMethod("destroy")},onDestroy:function(){this.model.collection.trigger("edit",this.model,!1),app.channel.trigger("modal:destroy",this,this.model)},_getAttributes:function(){var e={};return this.settings.each(function(t){e[t.get("id")]=t.get("value")},this),e}}),t.exports=i},{"./sections":63,"./tabs":65}],62:[function(e,t,n){t.exports=Marionette.CollectionView.extend({tagName:"ul",className:"controls controls--modal",emptyView:e("./empty-section"),getChildView:function(e){return window.Tailor.Controls.lookup(e.get("type"))},childViewOptions:function(e,t){var n={model:e};return"list"===e.get("type")&&(n.element=this.element,n.collection=this.element.collection),n},filter:function(e,t,n){return e.get("section")===this.model.get("id")},initialize:function(e){this.model=e.model,this.element=e.element,this.addEventListeners()},addEventListeners:function(){this.listenTo(this.model.collection,"select",this.onSelect)},onSelect:function(e){this.$el.toggle(e===this.model)}})},{"./empty-section":60}],63:[function(e,t,n){t.exports=Marionette.CollectionView.extend({childView:e("./section"),emptyView:e("./empty-modal"),childViewOptions:function(e,t){return{model:e,element:this.element,collection:this.controls}},initialize:function(e){this.element=e.element,this.controls=e.controls}})},{"./empty-modal":59,"./section":62}],64:[function(e,t,n){t.exports=Marionette.ItemView.extend({tagName:"li",className:"tab",attributes:{tabindex:0},events:{click:"select",keypress:"onKeyPress"},template:"#tmpl-tailor-modal-item",select:function(){this.triggerMethod("select")},onSelect:function(){this.model.trigger("select",this.model),this.el.focus()},onKeyPress:function(e){13===e.which&&this.select()}})},{}],65:[function(e,t,n){t.exports=Marionette.CollectionView.extend({tagName:"ul",className:"tabs",childView:e("./tab"),childEvents:{select:"onSelect"},onRender:function(){this.collection.length>0&&this.children.first().triggerMethod("select")},onSelect:function(e){this.children.each(function(t){t.$el.toggleClass("is-active",e===t)})}})},{"./tab":64}],66:[function(e,t,n){t.exports=Marionette.Module.extend({onStart:function(){this.addEventListeners()},addEventListeners:function(){this.listenTo(app.channel,"sidebar:save",this.onSave),this.listenTo(app.channel,"elements:restore",this.onRestoreElements),this.listenTo(app.channel,"element:delete",this.onDeleteElement),this.listenTo(app.channel,"template:save",this.onSaveTemplate),this.listenTo(app.channel,"template:import",this.onImportTemplate),this.listenTo(app.channel,"template:add",this.onAddTemplate),this.listenTo(app.channel,"template:delete",this.onDeleteTemplate)},onSave:function(){Tailor.Notify(window._l10n.savedPage,"success")},onRestoreElements:function(){Tailor.Notify(window._l10n.restoreElements,"success")},onDeleteElement:function(){Tailor.Notify(window._l10n.deletedElement,"success")},onSaveTemplate:function(){Tailor.Notify(window._l10n.savedTemplate,"success")},onImportTemplate:function(){Tailor.Notify(window._l10n.importedTemplate,"success")},onAddTemplate:function(){Tailor.Notify(window._l10n.addedTemplate,"success")},onDeleteTemplate:function(){Tailor.Notify(window._l10n.deletedTemplate,"success")}})},{}],67:[function(e,t,n){t.exports=Marionette.Module.extend({onStart:function(t){var n=e("./panels/show/layout");app.content.show(new n({panels:app.channel.request("sidebar:panels"),sections:app.channel.request("sidebar:sections"),controls:app.channel.request("sidebar:controls"),settings:app.channel.request("sidebar:settings")}))}})},{"./panels/show/layout":68}],68:[function(e,t,n){t.exports=Marionette.LayoutView.extend({ui:{pageTitle:".back-button"},className:"tailor-sidebar__layout",regions:{panels:"#tailor-sidebar-home",panel:"#tailor-sidebar-panel",section:"#tailor-sidebar-section"},childEvents:{"show:panel":"showPanel","show:section":"showSection","back:home":"displayHome","back:panel":"displayPanel"},template:function(){return document.getElementById("tmpl-tailor-sidebar-layout").innerHTML},initialize:function(e){this.panels=e.panels,this.sections=e.sections,this.controls=e.controls,this.settings=e.settings},onRender:function(){var t=e("./panels");this.showChildView("panels",new t({collection:this.panels}))},showPanel:function(e){this.displayPanel();var t=app.channel.request("sidebar:"+e.model.get("type")),n=window.Tailor.Panels.lookup(e.model.get("type"));this.showChildView("panel",new n({model:e.model,collection:t}))},showSection:function(e){this.el.classList.add("section-visible"),this.el.classList.remove("panel-visible");var t=window.Tailor.Sections.lookup(e.model.get("type"));this.showChildView("section",new t({model:e.model,collection:this.controls,panel:this.panels.findWhere({id:e.model.get("panel")})}))},displayHome:function(e){this.el.classList.remove("panel-visible"),this.el.classList.remove("section-visible"),e&&e.model.trigger("focus")},displayPanel:function(e){this.el.classList.remove("section-visible"),this.el.classList.add("panel-visible"),e&&e.model.trigger("focus")}})},{"./panels":70}],69:[function(e,t,n){t.exports=Marionette.ItemView.extend({className:"tailor-empty",template:"#tmpl-tailor-home-empty"})},{}],70:[function(e,t,n){t.exports=Marionette.CompositeView.extend({getChildView:function(){return window.Tailor.Items.lookup("panels")},childViewContainer:"#items",emptyView:e("./panels-empty"),behaviors:{Panel:{}},template:"#tmpl-tailor-home"})},{"./panels-empty":69}],71:[function(e,t,n){!function(t){"use strict";t.Resizable=e("./components/behaviors/resizable"),t.Draggable=e("./components/behaviors/draggable"),t.Panel=e("./components/behaviors/panel"),Marionette.Behaviors.behaviorsLookup=function(){return t},window.Tailor.Behaviors=t}(window.Tailor.Behaviors||{})},{"./components/behaviors/draggable":3,"./components/behaviors/panel":4,"./components/behaviors/resizable":5}],72:[function(e,t,n){!function(t,n,i,o){"use strict";t.Default=e("./components/panels/panel-default"),t.Templates=e("./components/panels/panel-templates"),t.lookup=function(e){return e=e.replace(/-/g," ").replace(/(?: |\b)(\w)/g,function(e){return e.toUpperCase().replace(/\s+/g,"")}),window.Tailor.Panels.hasOwnProperty(e)?window.Tailor.Panels[e]:window.Tailor.Panels.Default},n.Default=e("./components/sections/section-default"),n.lookup=function(e){return e=e.replace(/-/g," ").replace(/(?: |\b)(\w)/g,function(e){return e.toUpperCase().replace(/\s+/g,"")}),n.hasOwnProperty(e)?n[e]:n.Default},i=window.Tailor.Items||{},i.Default=e("./components/items/item-default"),i.Panels=e("./components/items/item-panels"),i.History=e("./components/items/item-history"),i.Library=e("./components/items/item-library"),i.Templates=e("./components/items/item-templates"),i.lookup=function(e){return e=e.replace(/-/g," ").replace(/(?: |\b)(\w)/g,function(e){return e.toUpperCase().replace(/\s+/g,"")}),i.hasOwnProperty(e)?i[e]:i.Default},o=window.Tailor.Controls||{},o.ButtonGroup=e("./components/controls/button-group"),o.Checkbox=e("./components/controls/checkbox"),o.Code=e("./components/controls/code"),o.Colorpicker=e("./components/controls/colorpicker"),o.Editor=e("./components/controls/editor"),o.Gallery=e("./components/controls/gallery"),o.Icon=e("./components/controls/icon"),o.Image=e("./components/controls/image"),o.Link=e("./components/controls/link"),o.List=e("./components/controls/list"),o.Radio=e("./components/controls/radio"),o.Range=e("./components/controls/range"),o.Select=e("./components/controls/select"),o.SelectMulti=e("./components/controls/select-multi"),o.Style=e("./components/controls/style"),o.Switch=e("./components/controls/switch"),o.Text=e("./components/controls/text"),o.Textarea=e("./components/controls/textarea"),o.Video=e("./components/controls/video"),o.lookup=function(e){return e=e.replace(/-/g," ").replace(/(?: |\b)(\w)/g,function(e){return e.toUpperCase().replace(/\s+/g,"")}),o.hasOwnProperty(e)?o[e]:o.Text},window.Tailor.Panels=t,window.Tailor.Sections=n,window.Tailor.Items=i,window.Tailor.Controls=o}(window.Tailor.Panels||{},window.Tailor.Sections||{},window.Tailor.Items||{},window.Tailor.Controls||{})},{"./components/controls/button-group":7,"./components/controls/checkbox":8,"./components/controls/code":9,"./components/controls/colorpicker":10,"./components/controls/editor":11,"./components/controls/gallery":12,"./components/controls/icon":13,"./components/controls/image":14,"./components/controls/link":15,"./components/controls/list":18,"./components/controls/radio":19,"./components/controls/range":20,"./components/controls/select":22,"./components/controls/select-multi":21,"./components/controls/style":23,"./components/controls/switch":24,"./components/controls/text":25,"./components/controls/textarea":26,"./components/controls/video":27,"./components/items/item-default":28,"./components/items/item-history":29,"./components/items/item-library":30,"./components/items/item-panels":31,"./components/items/item-templates":32,"./components/panels/panel-default":33,"./components/panels/panel-templates":35,"./components/sections/section-default":36}],73:[function(e,t,n){!function(t){"use strict";t.Section=e("./entities/models/library/model-wrapper"),t.Element=e("./entities/models/library/element"),t.Container=e("./entities/models/library/model-container"),t.Wrapper=e("./entities/models/library/model-wrapper"),t.lookup=function(e,n){return e=e.replace(/tailor_/g," ").replace(/(?: |\b)(\w)/g,function(e){return e.toUpperCase().replace(/\s+/g,"")}),t.hasOwnProperty(e)?t[e]:(n=n.replace(/_/g," ").replace(/(?: |\b)(\w)/g,function(e){return e.toUpperCase().replace(/\s+/g,"")}),t.hasOwnProperty(n)?t[n]:t.Element)},window.Tailor.Models=t}(window.Tailor.Models||{})},{"./entities/models/library/element":46,"./entities/models/library/model-container":47,"./entities/models/library/model-wrapper":48}],74:[function(e,t,n){!function(e,t){var n=document.querySelector(".tailor__home .title");e("_post_title",function(e,t){if(n.hasChildNodes())for(var i=n.childNodes,o=1;o<i.length;o++)3==i[o].nodeType&&-1!==i[o].nodeValue.indexOf(t)&&(i[o].nodeValue=e);document.title=window._l10n.tailoring+e}),t(".preview__control").on("change",function(e){var t=this.value,n=document.querySelector(".tailor-preview"),i=document.querySelector(".tailor-preview__viewport");i.classList.remove("is-loaded"),setTimeout(function(){n.className="tailor-preview "+t+"-screens"},250),setTimeout(function(){i.classList.add("is-loaded")},1e3)});var i=t(".devices button");i.on("click",function(e){var t=e.target,n=document.querySelector(".tailor-preview");i.each(function(){this==t?(this.classList.add("is-active"),this.setAttribute("aria-pressed","true"),n.className="tailor-preview "+t.getAttribute("data-device")+"-screens"):(this.classList.remove("is-active"),this.setAttribute("aria-pressed","false"))})}),i.first().click()}(Tailor.Api,jQuery)},{}],75:[function(e,t,n){e("./utility/polyfills/classlist"),e("./utility/polyfills/raf");var i=e("./apps/sidebar");window.app=new i,window.Tailor={Api:e("./components/api/setting"),Notify:e("./utility/notify")},window.ajax=e("./utility/ajax"),wp.media.view.settings.post.id=window.post.id,function(t,n){"use strict";e("./sidebar-behaviors"),e("./sidebar-components"),e("./sidebar-entities"),t.addRegions({content:"#tailor-sidebar-content",dialog:{selector:"#tailor-dialog-container",regionClass:e("./modules/dialog/dialog-region")},modal:{selector:"#tailor-modal-container",regionClass:e("./modules/modal/modal-region")}}),t.on("before:start",function(n){t.module("entities:settings",e("./entities/sidebar"))}),t.on("start",function(i){t.module("module:panels",e("./modules/panels")),t.module("module:modal",e("./modules/modal")),t.module("module:dialog",e("./modules/dialog")),t.module("module:notification",e("./modules/notification")),e("./sidebar-preview"),n(document).on("heartbeat-send",function(e,t){t.tailor_post_id=window.post.id}),wp.heartbeat.interval(60),wp.heartbeat.connectNow(),n(window).on("beforeunload.tailor",function(e){return t.hasUnsavedChanges()?window._l10n.confirmPage:void 0}).on("unload.tailor",function(e){window.ajax.send("tailor_unlock_post",{data:{post_id:i.postId,nonce:i.nonces.unlockPost}})})}),n(document).ready(function(){t.start({postId:window.post.id,nonces:window._nonces,library:window._library||[],templates:window._templates||[],panels:window._panels||[],sections:window._sections||[],settings:window._settings||[],controls:window._controls||[]})})}(window.app,jQuery)},{"./apps/sidebar":1,"./components/api/setting":2,"./entities/sidebar":53,"./modules/dialog":54,"./modules/dialog/dialog-region":55,"./modules/modal":57,"./modules/modal/modal-region":58,"./modules/notification":66,"./modules/panels":67,"./sidebar-behaviors":71,"./sidebar-components":72,"./sidebar-entities":73,"./sidebar-preview":74,"./utility/ajax":76,"./utility/notify":77,"./utility/polyfills/classlist":78,"./utility/polyfills/raf":79}],76:[function(e,t,n){var i,o=jQuery,i={url:window.ajaxurl,post:function(e,t){return ajax.send({data:_.isObject(e)?e:_.extend(t||{},{action:e})})},send:function(e,t){return _.isObject(e)?t=e:(t=t||{},t.data=_.extend(t.data||{},{action:e,tailor:1})),t=_.defaults(t||{},{type:"POST",url:ajax.url,context:this}),o.Deferred(function(e){t.success&&e.done(t.success);var n=t.error?t.error:ajax.onError;e.fail(n),delete t.success,delete t.error,o.ajax(t).done(function(t){("1"===t||1===t)&&(t={success:!0}),_.isObject(t)&&!_.isUndefined(t.success)?e[t.success?"resolveWith":"rejectWith"](this,[t.data]):e.rejectWith(this,[t])}).fail(function(){e.rejectWith(this,arguments)})}).promise()},onError:function(e){e&&e.hasOwnProperty("message")?Tailor.Notify(e.message):"0"==e?Tailor.Notify(window._l10n.expired):"-1"==e?Tailor.Notify(window._l10n.invalid):Tailor.Notify(window._l10n.error)}};t.exports=i},{}],77:[function(e,t,n){var i;e("./polyfills/transitions"),i=function(e){this.options=_.extend({},this.defaults,e),this.el=document.createElement("div"),this.el.className="notification notification--"+this.options.type,this.container=document.getElementById("tailor-notification-container")||document.body,this.initialize()},i.prototype={defaults:{message:"",type:"",ttl:3e3,onShow:function(){},onHide:function(){}},initialize:function(){this.el.innerHTML=this.options.message,this.container.insertBefore(this.el,this.container.firstChild)},show:function(){var e=this;e.el.classList.add("is-visible"),"function"==typeof e.options.onShow&&e.options.onShow.call(e),e.session=setTimeout(function(){e.hide()},e.options.ttl)},hide:function(){var e=this,t=function(n){if(Modernizr.cssanimations){if(n.target!==e.el)return!1;e.el.removeEventListener(window.transitionEndName,t)}e.container.removeChild(e.el),"function"==typeof e.options.onShow&&e.options.onShow.call(e)};clearTimeout(e.session),Modernizr.csstransitions?(e.el.addEventListener(window.transitionEndName,t),e.el.classList.remove("is-visible")):t()}};var o=function(e,t){var n=new i({message:e,type:t||"error"});n.show()};t.exports=o},{"./polyfills/transitions":80}],78:[function(e,t,n){!function(){function e(e){this.el=e;for(var t=e.className.replace(/^\s+|\s+$/g,"").split(/\s+/),n=0;n<t.length;n++)i.call(this,t[n])}function t(e,t,n){Object.defineProperty?Object.defineProperty(e,t,{get:n}):e.__defineGetter__(t,n)}if(!("undefined"==typeof window.Element||"classList"in document.documentElement)){var n=Array.prototype,i=n.push,o=n.splice,s=n.join;e.prototype={add:function(e){this.contains(e)||(i.call(this,e),this.el.className=this.toString())},contains:function(e){return-1!=this.el.className.indexOf(e)},item:function(e){return this[e]||null},remove:function(e){if(this.contains(e)){for(var t=0;t<this.length&&this[t]!=e;t++);o.call(this,t,1),this.el.className=this.toString()}},toString:function(){return s.call(this," ")},toggle:function(e){return this.contains(e)?this.remove(e):this.add(e),this.contains(e)}},window.DOMTokenList=e,t(Element.prototype,"classList",function(){return new e(this)})}}()},{}],79:[function(e,t,n){!function(e){"use strict";for(var t=0,n=["ms","moz","webkit","o"],i=0;i<n.length&&!e.requestAnimationFrame;++i)e.requestAnimationFrame=e[n[i]+"RequestAnimationFrame"],e.cancelAnimationFrame=e[n[i]+"CancelAnimationFrame"]||e[n[i]+"CancelRequestAnimationFrame"];e.requestAnimationFrame||(e.requestAnimationFrame=function(n,i){var o=(new Date).getTime(),s=Math.max(0,16-(o-t)),a=e.setTimeout(function(){n(o+s)},s);return t=o+s,a}),e.cancelAnimationFrame||(e.cancelAnimationFrame=function(e){clearTimeout(e)})}(window)},{}],80:[function(e,t,n){!function(e){"use strict";function t(){var e,t={animation:"animationend",OAnimation:"oAnimationEnd",MozAnimation:"animationend",WebkitAnimation:"webkitAnimationEnd"};for(e in t)if(t.hasOwnProperty(e)&&"undefined"!=typeof i.style[e])return t[e];return!1}function n(){var e,t={transition:"transitionend",OTransition:"oTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(e in t)if(t.hasOwnProperty(e)&&"undefined"!=typeof i.style[e])return t[e];return!1}var i=document.createElement("fakeelement");e.animationEndName=t(),e.transitionEndName=n()}(window)},{}]},{},[75]);